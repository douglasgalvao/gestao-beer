<mat-card-title>
    <mat-toolbar class="toolBarCadastroVenda">Cadastrar uma Venda</mat-toolbar>
</mat-card-title>
<mat-card-content>
    <div class="container">
        <form id="formNovaVenda" class="formContainer" [formGroup]="form">
            <mat-form-field class="formFieldCliente" appearance="fill">
                <mat-label>Selecione um Cliente</mat-label>
                <mat-select mat-autocomplete class="clienteSelect" [formControl]="clienteControl" name="cliente">
                    <mat-option>Nenhum</mat-option>
                    <mat-option *ngFor="let cliente of clientes; trackBy: trackByClienteFn" [value]="cliente.id">
                        {{cliente.nome}} - {{cliente.email}}
                    </mat-option>
                </mat-select>
            </mat-form-field>

            <mat-form-field class="formFieldFormaPagamento" appearance="fill">
                <mat-label>Selecione a Forma de Pagamento</mat-label>
                <mat-select class="formaPagamentoSelect" [formControl]="formaPagamentoControl" name="formaPagamento"
                    formControlName="formaPagamento">
                    <mat-option value="AVISTA">Á vista</mat-option>
                    <mat-option value="CARTAO_DEBITO">Cartão de Débito</mat-option>
                    <mat-option value="CARTAO_CREDITO">Cartão de Crédito</mat-option>
                </mat-select>
                <div *ngIf="form.get('formaPagamento')?.hasError('required') && form.get('formaPagamento')?.touched">
                    <mat-error>Forma de Pagamento é obrigatório</mat-error>
                </div>
            </mat-form-field>

            <mat-form-field class="formFieldStatusPagamento" appearance="fill">
                <mat-label>Status Pagamento</mat-label>
                <mat-select class="statusPagamentoSelect" [formControl]="statusPagamentoControl"
                    formControlName="statusPagamento" name="statusPagamento">
                    <mat-option value="PAGO">Pago</mat-option>
                    <mat-option value="PENDENTE">Pendente</mat-option>
                </mat-select>
            </mat-form-field>

            <mat-form-field class="formFieldProdutos" appearance="fill">
                <mat-label>Selecione os Produtos</mat-label>
                <mat-select [formControl]="produtoControl" name="produtos" formControlName="produto" multiple>

                    <mat-optgroup *ngFor="let group of produtosAgrupados" [label]="group.categoria">
                        <mat-option *ngFor="let produto of group.produtos" [value]="produto">
                            {{ produto.nome }} - {{ produto.preco | currency }}
                        </mat-option>
                    </mat-optgroup>
                    <mat-error *ngIf="form.get('produto')?.hasError('required') && form.get('produto')?.touched">
                        Produto é obrigatório
                    </mat-error>
                </mat-select>
            </mat-form-field>


            <div class="cardsSelecionadosContent">
                <mat-card class="cardProdutosSelecionados">
                    <div class="titleContent">
                        <mat-toolbar class="toolBarProdutosSelecionados">
                            Produtos Selecionados
                        </mat-toolbar>
                    </div>
                    <mat-card-content>
                        <div class="selected-products">
                            <div *ngFor="let produto of produtoControl.value" class="selected-product">
                                {{ produto.nome }} - {{ produto.preco | currency }} ({{ produto.quantidade?
                                produto.quantidade : 1 }})
                                sub-total - {{produto.subtotal | currency}}
                                <div class="quantity-controls">
                                    <button mat-icon-button type="button" (click)="decrementQuantity(produto)">
                                        <mat-icon>remove</mat-icon>
                                    </button>
                                    <span> {{ produto.quantidade ? produto.quantidade : 1 }}</span>
                                    <button mat-icon-button type="button" (click)="incrementQuantity(produto)">
                                        <mat-icon>add</mat-icon>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </mat-card-content>
                </mat-card>
            </div>
        </form>
    </div>
</mat-card-content>
<mat-card-actions class="actionsContent">
    <div class="fieldACtionsButtons">
        <button type="submit" form="formNovaVenda" [disabled]="!form.valid" mat-raised-button
            class="buttonCadastrarNovaVenda" (click)="cadastrarVenda()">Cadastrar
            Venda</button>
        <button mat-raised-button class="buttonCloseNovaVendaDialog" color="warn"
            (click)="closeDialogNovaVenda()">Fechar</button>
    </div>
</mat-card-actions>